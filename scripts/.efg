#!/usr/local/bin/bash

echo "Setting up eFG environment" #and cd'ing to $EFG_SRC" 

#add alias efg='. ~/src/ensembl-efg/.efg' to your .bashrc

# ENV VARS
export EFG_SRC=~/src/ensembl-functgenomics
export EFG_SQL="${EFG_SRC}/sql"
export EFG_DATA=~/data/efg
#should make data dirs here

export PATH=$PATH:$EFG_SRC/scripts
export PERL5LIB=$EFG_SRC/modules:$PERL5LIB
export PS1='efg@$PS1HOST>'
export WRITE_NAME="-uensadmin"
export READ_NAME="-uensro"
export MYSQL_ARGS="-hens-genomics1 -P3306"

#could add PERL5LIB here too, this could be extended to include all config for shipping to users?  in bashrc for now


# ALIASES
alias efg='cd $EFG_SRC'
alias efgd='cd $EFG_DATA'
alias efgm='cd $EFG_SRC/modules/Bio/EnsEMBL/Funcgen'
alias efgmacs='xemacs $EFG_SRC/modules/Bio/EnsEMBL/Funcgen &'

alias mysqlw="mysql $MYSQL_ARGS $WRITE_NAME"
alias mysqlro="mysql $MYSQL_ARGS $READ_NAME"


CreateDB(){
    DBNAME=$1
    PASS=$2
	
    #check vars here

    PRESENT=$(QueryVal show databases like \"$DBNAME\")

    if [[ $PRESENT ]]
    then
	echo "DB $DBNAME already exists, please check and drop DB before continuing"
    else
	echo "Creating $DBNAME"
	echo "create database $DBNAME" | mysqlw -p${PASS}
	mysqlw -p${PASS} $DBNAME < $EFG_SQL/efg.sql
    fi

	
}

QueryVal(){

    #need to check if PASS defined else use READ_NAME
    val=$(echo $* | mysqlro)

	#should capture error here
	#this works differently if passing a var or passing a quoted string, var get's split
	#do not quote query!
	echo $val | sed "s/$2 //"
}







